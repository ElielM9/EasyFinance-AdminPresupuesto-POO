const expensesList=document.querySelector("#expensesList");function startApp(){loadLocalStorage(),budgetFormEvents()}document.addEventListener("DOMContentLoaded",startApp);class Budget{constructor(e){this.budgetTotal=e,this.budgetAvailable=e,this.budgetSpent=0,this.expenses=[]}newExpenses(e){e.inputAmount>this.budgetAvailable?userInterface.printAlerts("No tienes fondos suficientes","error"):(this.expenses=[...this.expenses,e],this.calculateSpent(),userInterface.printAlerts("Se agregó correctamente","success"))}calculateSpent(){this.budgetSpent=this.expenses.reduce((e,t)=>e+t.inputAmount,0),this.budgetAvailable=this.budgetTotal-this.budgetSpent}deleteExpense(e){const t=this.expenses.filter(t=>t.id!==e);this.expenses=t,this.calculateSpent()}}class UserInterface{insertName(e){document.querySelector(".budget__heading--user-name").textContent=e+"!"}insertBudget(e){const{budgetTotal:t,budgetAvailable:n,budgetSpent:s}=e;let r=t.toLocaleString("es-MX",{style:"currency",currency:"MXN"}),u=n.toLocaleString("es-MX",{style:"currency",currency:"MXN"}),o=s.toLocaleString("es-MX",{style:"currency",currency:"MXN"});document.querySelector("#budgetCardTotal").textContent=""+r,document.querySelector("#budgetCardAvailable").textContent=""+u,document.querySelector("#budgetCardSpent").textContent=""+o}printAlerts(e,t){let n=document.querySelector(".alert--"+t);if(n)return void(n.textContent=e);const s=document.createElement("p");s.classList.add("alert"),"error"===t?s.classList.add("alert--error"):s.classList.add("alert--success"),s.textContent=e;document.querySelector("#budgetForm").appendChild(s),setTimeout(()=>{s.remove()},2e3)}showExpenseList(e){this.cleanHtml(),e.forEach(e=>{const{inputName:t,inputAmount:n,selectedCategory:s,id:r}=e,u=n.toLocaleString("es-MX",{style:"currency",currency:"MXN"}),o=document.createElement("li");o.className="expense-item",o.dataset.id=r,o.dataset.category=s,o.innerHTML=`\n        <div class="expense-item__texts">\n          <p class="expense-item__description">${t}</p>\n          <p class="expense-item__price">${u}</p>\n        </div>\n      `;const a=document.createElement("button");a.classList.add("expense-item__btn"),a.textContent="X",a.addEventListener("click",()=>{deleteExpense(r)}),o.appendChild(a),expensesList.appendChild(o)})}cleanHtml(){for(;expensesList.firstChild;)expensesList.removeChild(expensesList.firstChild)}updateAvailableBudget(e,t){let n=e.toLocaleString("es-MX",{style:"currency",currency:"MXN"}),s=t.toLocaleString("es-MX",{style:"currency",currency:"MXN"});document.querySelector("#budgetCardAvailable").textContent=""+n,document.querySelector("#budgetCardSpent").textContent=""+s}checkBudget(e){const{budgetTotal:t,budgetAvailable:n}=e,s=document.querySelector(".budget-form__btn");n<=0?(userInterface.printAlerts("El presupuesto se ha agotado","error"),s.disabled=!0):s.disabled=!1}}let budget;const userInterface=new UserInterface;function loadLocalStorage(){let e=JSON.parse(localStorage.getItem("username"));if(budget=JSON.parse(localStorage.getItem("budget")),e?userInterface.insertName(e):requestName(e),budget){const{budgetTotal:e,budgetAvailable:t,budgetSpent:n,expenses:s}=budget;console.log(budget),budget=new Budget(e),console.log(budget),userInterface.insertBudget(budget),loadExpensesToLocalStorage(t,n,s)}else requestBudget()}function loadExpensesToLocalStorage(e,t,n){userInterface.showExpenseList(n),userInterface.updateAvailableBudget(e,t),userInterface.checkBudget(budget)}function requestName(e){do{(e=prompt("¿Cuál es tu nombre?"))||alert("Por favor, introduce un nombre válido.")}while(!e);userInterface.insertName(e),saveToLocalStorage("username",e)}function requestBudget(){const e=Number(prompt("¿Cuál es tu presupuesto?"));(""===e||null===e||isNaN(e)||e<=0)&&window.location.reload(),budget=new Budget(e),userInterface.insertBudget(budget),saveToLocalStorage("budget",budget)}function budgetFormEvents(){document.querySelector("#budgetForm").addEventListener("submit",addExpense)}function addExpense(e){e.preventDefault();const t=document.querySelector("#budgetFormName").value,n=Number(document.querySelector("#budgetFormAmount").value),s=document.querySelector("#budgetFormCategory").value;if(""===t||""===n||""===s)return void userInterface.printAlerts("Todos los campos son obligatorios","error");if(n<=0||isNaN(n))return void userInterface.printAlerts("Cantidad no valida","error");const r={inputName:t,inputAmount:n,selectedCategory:s,id:Date.now()};budget.newExpenses(r);const{expenses:u,budgetAvailable:o,budgetSpent:a}=budget;userInterface.showExpenseList(u),userInterface.updateAvailableBudget(o,a),userInterface.checkBudget(budget);document.querySelector("#budgetForm").reset(),saveToLocalStorage("budget",budget)}function deleteExpense(e){budget.deleteExpense(e);const{expenses:t,budgetAvailable:n,budgetSpent:s}=budget;userInterface.showExpenseList(t),userInterface.updateAvailableBudget(n,s),userInterface.checkBudget(budget),saveToLocalStorage("budget",budget)}function saveToLocalStorage(e,t){localStorage.setItem(e,JSON.stringify(t))}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZXhwZW5zZXNMaXN0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic3RhcnRBcHAiLCJsb2FkTG9jYWxTdG9yYWdlIiwiYnVkZ2V0Rm9ybUV2ZW50cyIsImFkZEV2ZW50TGlzdGVuZXIiLCJCdWRnZXQiLCJbb2JqZWN0IE9iamVjdF0iLCJidWRnZXRUb3RhbCIsInRoaXMiLCJidWRnZXRBdmFpbGFibGUiLCJidWRnZXRTcGVudCIsImV4cGVuc2VzIiwiZXhwZW5zZSIsImlucHV0QW1vdW50IiwidXNlckludGVyZmFjZSIsInByaW50QWxlcnRzIiwiY2FsY3VsYXRlU3BlbnQiLCJyZWR1Y2UiLCJ0b3RhbCIsImV4cGVuc2VJZCIsImZpbHRlcmVkRXhwZW5zZXMiLCJmaWx0ZXIiLCJpZCIsIlVzZXJJbnRlcmZhY2UiLCJ1c2VyTmFtZSIsInRleHRDb250ZW50IiwicXVhbnRpdHkiLCJmb3JtYXR0ZWRUb3RhbCIsInRvTG9jYWxlU3RyaW5nIiwic3R5bGUiLCJjdXJyZW5jeSIsImZvcm1hdHRlZEF2YWlsYWJsZSIsImZvcm1hdHRlZFNwZW50IiwibWVzc2FnZSIsInR5cGVBbGVydCIsImV4aXN0aW5nQWxlcnQiLCJhbGVydE1lc3NhZ2UiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJzZXRUaW1lb3V0IiwicmVtb3ZlIiwiY2xlYW5IdG1sIiwiZm9yRWFjaCIsImlucHV0TmFtZSIsInNlbGVjdGVkQ2F0ZWdvcnkiLCJmb3JtYXR0ZWRBbW91bnQiLCJleHBlbnNlSXRlbSIsImNsYXNzTmFtZSIsImRhdGFzZXQiLCJjYXRlZ29yeSIsImlubmVySFRNTCIsImRlbGV0ZUJ0biIsImRlbGV0ZUV4cGVuc2UiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJhdmFpbGFibGUiLCJzcGVudCIsImJ1ZGdldE9iaiIsImJ1ZGdldEZvcm1CdG4iLCJkaXNhYmxlZCIsImJ1ZGdldCIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJpbnNlcnROYW1lIiwicmVxdWVzdE5hbWUiLCJjb25zb2xlIiwibG9nIiwiaW5zZXJ0QnVkZ2V0IiwibG9hZEV4cGVuc2VzVG9Mb2NhbFN0b3JhZ2UiLCJyZXF1ZXN0QnVkZ2V0Iiwic2hvd0V4cGVuc2VMaXN0IiwidXBkYXRlQXZhaWxhYmxlQnVkZ2V0IiwiY2hlY2tCdWRnZXQiLCJwcm9tcHQiLCJhbGVydCIsInNhdmVUb0xvY2FsU3RvcmFnZSIsInVzZXJCdWRnZXQiLCJOdW1iZXIiLCJpc05hTiIsIndpbmRvdyIsImxvY2F0aW9uIiwicmVsb2FkIiwiYWRkRXhwZW5zZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwiRGF0ZSIsIm5vdyIsIm5ld0V4cGVuc2VzIiwicmVzZXQiLCJrZXkiLCJzZXRJdGVtIiwic3RyaW5naWZ5Il0sIm1hcHBpbmdzIjoiQUFDQSxNQUFNQSxhQUFlQyxTQUFTQyxjQUFjLGlCQUs1QyxTQUFTQyxXQUNQQyxtQkFDQUMsbUJBSkZKLFNBQVNLLGlCQUFpQixtQkFBb0JILFVBUTlDLE1BQU1JLE9BQ0pDLFlBQVlDLEdBQ1ZDLEtBQUtELFlBQWNBLEVBQ25CQyxLQUFLQyxnQkFBa0JGLEVBQ3ZCQyxLQUFLRSxZQUFjLEVBQ25CRixLQUFLRyxTQUFXLEdBR2xCTCxZQUFZTSxHQUVOQSxFQUFRQyxZQUFjTCxLQUFLQyxnQkFDN0JLLGNBQWNDLFlBQVksK0JBQWdDLFVBTTVEUCxLQUFLRyxTQUFXLElBQUlILEtBQUtHLFNBQVVDLEdBQ25DSixLQUFLUSxpQkFHTEYsY0FBY0MsWUFBWSwwQkFBMkIsWUFHdkRULGlCQUNFRSxLQUFLRSxZQUFjRixLQUFLRyxTQUFTTSxPQUMvQixDQUFDQyxFQUFPTixJQUFZTSxFQUFRTixFQUFRQyxZQUNwQyxHQUVGTCxLQUFLQyxnQkFBa0JELEtBQUtELFlBQWNDLEtBQUtFLFlBR2pESixjQUFjYSxHQUVaLE1BQU1DLEVBQW1CWixLQUFLRyxTQUFTVSxPQUNwQ1QsR0FBWUEsRUFBUVUsS0FBT0gsR0FJOUJYLEtBQUtHLFNBQVdTLEVBR2hCWixLQUFLUSxrQkFJVCxNQUFNTyxjQUNKakIsV0FBV2tCLEdBQ2N6QixTQUFTQyxjQUM5QiwrQkFJYXlCLFlBQWlCRCxFQUFILElBRy9CbEIsYUFBYW9CLEdBQ1gsTUFBTW5CLFlBQUVBLEVBQVdFLGdCQUFFQSxFQUFlQyxZQUFFQSxHQUFnQmdCLEVBR3RELElBQUlDLEVBQWlCcEIsRUFBWXFCLGVBQWUsUUFBUyxDQUN2REMsTUFBTyxXQUNQQyxTQUFVLFFBRVJDLEVBQXFCdEIsRUFBZ0JtQixlQUFlLFFBQVMsQ0FDL0RDLE1BQU8sV0FDUEMsU0FBVSxRQUVSRSxFQUFpQnRCLEVBQVlrQixlQUFlLFFBQVMsQ0FDdkRDLE1BQU8sV0FDUEMsU0FBVSxRQUlaL0IsU0FBU0MsY0FDUCxvQkFDQXlCLFlBQWMsR0FBR0UsRUFDbkI1QixTQUFTQyxjQUNQLHdCQUNBeUIsWUFBYyxHQUFHTSxFQUNuQmhDLFNBQVNDLGNBQ1Asb0JBQ0F5QixZQUFjLEdBQUdPLEVBR3JCMUIsWUFBWTJCLEVBQVNDLEdBRW5CLElBQUlDLEVBQWdCcEMsU0FBU0MsY0FBYyxXQUFXa0MsR0FHdEQsR0FBSUMsRUFHRixZQUZBQSxFQUFjVixZQUFjUSxHQU05QixNQUFNRyxFQUFlckMsU0FBU3NDLGNBQWMsS0FDNUNELEVBQWFFLFVBQVVDLElBQUksU0FHVCxVQUFkTCxFQUNGRSxFQUFhRSxVQUFVQyxJQUFJLGdCQUUzQkgsRUFBYUUsVUFBVUMsSUFBSSxrQkFJN0JILEVBQWFYLFlBQWNRLEVBR1JsQyxTQUFTQyxjQUFjLGVBQy9Cd0MsWUFBWUosR0FHdkJLLFdBQVcsS0FDVEwsRUFBYU0sVUFDWixLQUdMcEMsZ0JBQWdCSyxHQUVkSCxLQUFLbUMsWUFHTGhDLEVBQVNpQyxRQUFTaEMsSUFDaEIsTUFBTWlDLFVBQUVBLEVBQVNoQyxZQUFFQSxFQUFXaUMsaUJBQUVBLEVBQWdCeEIsR0FBRUEsR0FBT1YsRUFHbkRtQyxFQUFrQmxDLEVBQVllLGVBQWUsUUFBUyxDQUMxREMsTUFBTyxXQUNQQyxTQUFVLFFBSU5rQixFQUFjakQsU0FBU3NDLGNBQWMsTUFDM0NXLEVBQVlDLFVBQVksZUFDeEJELEVBQVlFLFFBQVE1QixHQUFLQSxFQUN6QjBCLEVBQVlFLFFBQVFDLFNBQVdMLEVBRy9CRSxFQUFZSSxVQUFZLCtGQUVtQlAsbURBQ05FLGdDQUtyQyxNQUFNTSxFQUFZdEQsU0FBU3NDLGNBQWMsVUFDekNnQixFQUFVZixVQUFVQyxJQUFJLHFCQUN4QmMsRUFBVTVCLFlBQWMsSUFDeEI0QixFQUFVakQsaUJBQWlCLFFBQVMsS0FDbENrRCxjQUFjaEMsS0FJaEIwQixFQUFZUixZQUFZYSxHQUd4QnZELGFBQWEwQyxZQUFZUSxLQUk3QjFDLFlBQ0UsS0FBT1IsYUFBYXlELFlBQ2xCekQsYUFBYTBELFlBQVkxRCxhQUFheUQsWUFJMUNqRCxzQkFBc0JtRCxFQUFXQyxHQUMvQixJQUFJM0IsRUFBcUIwQixFQUFVN0IsZUFBZSxRQUFTLENBQ3pEQyxNQUFPLFdBQ1BDLFNBQVUsUUFFUkUsRUFBaUIwQixFQUFNOUIsZUFBZSxRQUFTLENBQ2pEQyxNQUFPLFdBQ1BDLFNBQVUsUUFJWi9CLFNBQVNDLGNBQ1Asd0JBQ0F5QixZQUFjLEdBQUdNLEVBQ25CaEMsU0FBU0MsY0FDUCxvQkFDQXlCLFlBQWMsR0FBR08sRUFHckIxQixZQUFZcUQsR0FDVixNQUFNcEQsWUFBRUEsRUFBV0UsZ0JBQUVBLEdBQW9Ca0QsRUFRbkNDLEVBQWdCN0QsU0FBU0MsY0FBYyxxQkFHekNTLEdBQW1CLEdBQ3JCSyxjQUFjQyxZQUFZLCtCQUFnQyxTQUMxRDZDLEVBQWNDLFVBQVcsR0FFekJELEVBQWNDLFVBQVcsR0FNL0IsSUFBSUMsT0FDSixNQUFNaEQsY0FBZ0IsSUFBSVMsY0FJMUIsU0FBU3JCLG1CQUNQLElBQUlzQixFQUFXdUMsS0FBS0MsTUFBTUMsYUFBYUMsUUFBUSxhQVkvQyxHQVhBSixPQUFTQyxLQUFLQyxNQUFNQyxhQUFhQyxRQUFRLFdBR3JDMUMsRUFDRlYsY0FBY3FELFdBQVczQyxHQUd6QjRDLFlBQVk1QyxHQUlWc0MsT0FBUSxDQUNWLE1BQU12RCxZQUFFQSxFQUFXRSxnQkFBRUEsRUFBZUMsWUFBRUEsRUFBV0MsU0FBRUEsR0FBYW1ELE9BRWhFTyxRQUFRQyxJQUFJUixRQUVaQSxPQUFTLElBQUl6RCxPQUFPRSxHQUNwQjhELFFBQVFDLElBQUlSLFFBR1poRCxjQUFjeUQsYUFBYVQsUUFHM0JVLDJCQUEyQi9ELEVBQWlCQyxFQUFhQyxRQUd6RDhELGdCQUlKLFNBQVNELDJCQUEyQi9ELEVBQWlCQyxFQUFhQyxHQUVoRUcsY0FBYzRELGdCQUFnQi9ELEdBRzlCRyxjQUFjNkQsc0JBQXNCbEUsRUFBaUJDLEdBR3JESSxjQUFjOEQsWUFBWWQsUUFHNUIsU0FBU00sWUFBWTVDLEdBRW5CLElBQ0VBLEVBQVdxRCxPQUFPLHlCQUloQkMsTUFBTSxpREFFQXRELEdBR1ZWLGNBQWNxRCxXQUFXM0MsR0FHekJ1RCxtQkFBbUIsV0FBWXZELEdBR2pDLFNBQVNpRCxnQkFDUCxNQUFNTyxFQUFhQyxPQUFPSixPQUFPLDhCQUNmLEtBR2hCRyxHQUNlLE9BQWZBLEdBQ0FFLE1BQU1GLElBQ05BLEdBQWMsSUFFZEcsT0FBT0MsU0FBU0MsU0FJbEJ2QixPQUFTLElBQUl6RCxPQUFPMkUsR0FHcEJsRSxjQUFjeUQsYUFBYVQsUUFHM0JpQixtQkFBbUIsU0FBVWpCLFFBRy9CLFNBQVMzRCxtQkFFWUosU0FBU0MsY0FBYyxlQUMvQkksaUJBQWlCLFNBQVVrRixZQUd4QyxTQUFTQSxXQUFXQyxHQUNsQkEsRUFBRUMsaUJBR0YsTUFBTTNDLEVBQVk5QyxTQUFTQyxjQUFjLG1CQUFtQnlGLE1BQ3RENUUsRUFBY29FLE9BQU9sRixTQUFTQyxjQUFjLHFCQUFxQnlGLE9BQ2pFM0MsRUFBbUIvQyxTQUFTQyxjQUFjLHVCQUF1QnlGLE1BSXZFLEdBSGdCLEtBSWQ1QyxHQUpjLEtBS2RoQyxHQUxjLEtBTWRpQyxFQUlBLFlBRkFoQyxjQUFjQyxZQUFZLG9DQUFxQyxTQUcxRCxHQUFJRixHQUFlLEdBQUtxRSxNQUFNckUsR0FHbkMsWUFGQUMsY0FBY0MsWUFBWSxxQkFBc0IsU0FNbEQsTUFBTUgsRUFBVSxDQUFFaUMsVUFBQUEsRUFBV2hDLFlBQUFBLEVBQWFpQyxpQkFBQUEsRUFBa0J4QixHQUFJb0UsS0FBS0MsT0FHckU3QixPQUFPOEIsWUFBWWhGLEdBR25CLE1BQU1ELFNBQUVBLEVBQVFGLGdCQUFFQSxFQUFlQyxZQUFFQSxHQUFnQm9ELE9BR25EaEQsY0FBYzRELGdCQUFnQi9ELEdBRzlCRyxjQUFjNkQsc0JBQXNCbEUsRUFBaUJDLEdBR3JESSxjQUFjOEQsWUFBWWQsUUFHUC9ELFNBQVNDLGNBQWMsZUFDL0I2RixRQUdYZCxtQkFBbUIsU0FBVWpCLFFBRy9CLFNBQVNSLGNBQWNoQyxHQUVyQndDLE9BQU9SLGNBQWNoQyxHQUdyQixNQUFNWCxTQUFFQSxFQUFRRixnQkFBRUEsRUFBZUMsWUFBRUEsR0FBZ0JvRCxPQUduRGhELGNBQWM0RCxnQkFBZ0IvRCxHQUc5QkcsY0FBYzZELHNCQUFzQmxFLEVBQWlCQyxHQUdyREksY0FBYzhELFlBQVlkLFFBRzFCaUIsbUJBQW1CLFNBQVVqQixRQUcvQixTQUFTaUIsbUJBQW1CZSxFQUFLTCxHQUUvQnhCLGFBQWE4QixRQUFRRCxFQUFLL0IsS0FBS2lDLFVBQVVQIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBWYXJpYWJsZXMgeSBzZWxlY3RvcmVzICovXG5jb25zdCBleHBlbnNlc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjZXhwZW5zZXNMaXN0YCk7XG5cbi8qIEV2ZW50b3MgKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoYERPTUNvbnRlbnRMb2FkZWRgLCBzdGFydEFwcCk7XG5cbmZ1bmN0aW9uIHN0YXJ0QXBwKCkge1xuICBsb2FkTG9jYWxTdG9yYWdlKCk7XG4gIGJ1ZGdldEZvcm1FdmVudHMoKTtcbn1cblxuLyogQ2xhc2VzICovXG5jbGFzcyBCdWRnZXQge1xuICBjb25zdHJ1Y3RvcihidWRnZXRUb3RhbCkge1xuICAgIHRoaXMuYnVkZ2V0VG90YWwgPSBidWRnZXRUb3RhbDtcbiAgICB0aGlzLmJ1ZGdldEF2YWlsYWJsZSA9IGJ1ZGdldFRvdGFsO1xuICAgIHRoaXMuYnVkZ2V0U3BlbnQgPSAwO1xuICAgIHRoaXMuZXhwZW5zZXMgPSBbXTtcbiAgfVxuXG4gIG5ld0V4cGVuc2VzKGV4cGVuc2UpIHtcbiAgICAvLyBWYWxpZGFyIHF1ZSBlbCBtb250byBpbnRyb2R1Y2lkbyBubyBzZWEgbWF5b3IgYWwgcHJlc3VwdWVzdG8gZGlzcG9uaWJsZVxuICAgIGlmIChleHBlbnNlLmlucHV0QW1vdW50ID4gdGhpcy5idWRnZXRBdmFpbGFibGUpIHtcbiAgICAgIHVzZXJJbnRlcmZhY2UucHJpbnRBbGVydHMoYE5vIHRpZW5lcyBmb25kb3Mgc3VmaWNpZW50ZXNgLCBgZXJyb3JgKTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEHDsWFkaXIgZWwgZ2FzdG8gYSBsYSBsaXN0YSBkZSBnYXN0b3NcbiAgICB0aGlzLmV4cGVuc2VzID0gWy4uLnRoaXMuZXhwZW5zZXMsIGV4cGVuc2VdO1xuICAgIHRoaXMuY2FsY3VsYXRlU3BlbnQoKTtcblxuICAgIC8vIEltcHJpbWlyIHVuYSBhbGVydGEgZGUgZXhpdG9cbiAgICB1c2VySW50ZXJmYWNlLnByaW50QWxlcnRzKGBTZSBhZ3JlZ8OzIGNvcnJlY3RhbWVudGVgLCBgc3VjY2Vzc2ApO1xuICB9XG5cbiAgY2FsY3VsYXRlU3BlbnQoKSB7XG4gICAgdGhpcy5idWRnZXRTcGVudCA9IHRoaXMuZXhwZW5zZXMucmVkdWNlKFxuICAgICAgKHRvdGFsLCBleHBlbnNlKSA9PiB0b3RhbCArIGV4cGVuc2UuaW5wdXRBbW91bnQsXG4gICAgICAwXG4gICAgKTtcbiAgICB0aGlzLmJ1ZGdldEF2YWlsYWJsZSA9IHRoaXMuYnVkZ2V0VG90YWwgLSB0aGlzLmJ1ZGdldFNwZW50O1xuICB9XG5cbiAgZGVsZXRlRXhwZW5zZShleHBlbnNlSWQpIHtcbiAgICAvLyBGaWx0cmFyIGxvcyBnYXN0b3MgcXVlIG5vIHRpZW5lbiBlbCBpZCBkZSBleHBlbnNlc0lkXG4gICAgY29uc3QgZmlsdGVyZWRFeHBlbnNlcyA9IHRoaXMuZXhwZW5zZXMuZmlsdGVyKFxuICAgICAgKGV4cGVuc2UpID0+IGV4cGVuc2UuaWQgIT09IGV4cGVuc2VJZFxuICAgICk7XG5cbiAgICAvLyBBY3R1YWxpemFyIGVsIGFycmF5IGRlIGdhc3Rvc1xuICAgIHRoaXMuZXhwZW5zZXMgPSBmaWx0ZXJlZEV4cGVuc2VzO1xuXG4gICAgLy8gUmVjYWxjdWxhciBlbCBwcmVzdXB1ZXN0byBkaXNwb25pYmxlIHkgZ2FzdGFkb1xuICAgIHRoaXMuY2FsY3VsYXRlU3BlbnQoKTtcbiAgfVxufVxuXG5jbGFzcyBVc2VySW50ZXJmYWNlIHtcbiAgaW5zZXJ0TmFtZSh1c2VyTmFtZSkge1xuICAgIGNvbnN0IGJ1ZGdldFVzZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAuYnVkZ2V0X19oZWFkaW5nLS11c2VyLW5hbWVgXG4gICAgKTtcblxuICAgIC8vIEluc2VydGFyIGVsIG5vbWJyZSBkZWwgdXN1YXJpbyBlbiBlbCBIVE1MXG4gICAgYnVkZ2V0VXNlck5hbWUudGV4dENvbnRlbnQgPSBgJHt1c2VyTmFtZX0hYDtcbiAgfVxuXG4gIGluc2VydEJ1ZGdldChxdWFudGl0eSkge1xuICAgIGNvbnN0IHsgYnVkZ2V0VG90YWwsIGJ1ZGdldEF2YWlsYWJsZSwgYnVkZ2V0U3BlbnQgfSA9IHF1YW50aXR5O1xuXG4gICAgLy8gRm9ybWF0ZWFyIGVsIHRvdGFsIHkgZGlzcG9uaWJsZSBlbiBtb25lZGEgbG9jYWwgTVhOXG4gICAgbGV0IGZvcm1hdHRlZFRvdGFsID0gYnVkZ2V0VG90YWwudG9Mb2NhbGVTdHJpbmcoXCJlcy1NWFwiLCB7XG4gICAgICBzdHlsZTogXCJjdXJyZW5jeVwiLFxuICAgICAgY3VycmVuY3k6IFwiTVhOXCIsXG4gICAgfSk7XG4gICAgbGV0IGZvcm1hdHRlZEF2YWlsYWJsZSA9IGJ1ZGdldEF2YWlsYWJsZS50b0xvY2FsZVN0cmluZyhcImVzLU1YXCIsIHtcbiAgICAgIHN0eWxlOiBcImN1cnJlbmN5XCIsXG4gICAgICBjdXJyZW5jeTogXCJNWE5cIixcbiAgICB9KTtcbiAgICBsZXQgZm9ybWF0dGVkU3BlbnQgPSBidWRnZXRTcGVudC50b0xvY2FsZVN0cmluZyhcImVzLU1YXCIsIHtcbiAgICAgIHN0eWxlOiBcImN1cnJlbmN5XCIsXG4gICAgICBjdXJyZW5jeTogXCJNWE5cIixcbiAgICB9KTtcblxuICAgIC8vIEluc2VydGFyIGVsIHRvdGFsIHkgZGlzcG9uaWJsZSBlbiBlbCBIVE1MXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIGAjYnVkZ2V0Q2FyZFRvdGFsYFxuICAgICkudGV4dENvbnRlbnQgPSBgJHtmb3JtYXR0ZWRUb3RhbH1gO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI2J1ZGdldENhcmRBdmFpbGFibGVgXG4gICAgKS50ZXh0Q29udGVudCA9IGAke2Zvcm1hdHRlZEF2YWlsYWJsZX1gO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI2J1ZGdldENhcmRTcGVudGBcbiAgICApLnRleHRDb250ZW50ID0gYCR7Zm9ybWF0dGVkU3BlbnR9YDtcbiAgfVxuXG4gIHByaW50QWxlcnRzKG1lc3NhZ2UsIHR5cGVBbGVydCkge1xuICAgIC8vIExpbXBpYXIgbGFzIGFsZXJ0YXMgYW50ZXJpb3JlcyBwYXJhIGV2aXRhciBkdXBsaWNhZG9zLlxuICAgIGxldCBleGlzdGluZ0FsZXJ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmFsZXJ0LS0ke3R5cGVBbGVydH1gKTtcblxuICAgIC8vIFNpIGhheSB1bmEgYWxlcnRhIGRlbCBtaXNtbyB0aXBvLCBhY3R1YWxpemFyIGVsIG1lbnNhamUgeSBubyBhZ3JlZ2FyIHVubyBudWV2b1xuICAgIGlmIChleGlzdGluZ0FsZXJ0KSB7XG4gICAgICBleGlzdGluZ0FsZXJ0LnRleHRDb250ZW50ID0gbWVzc2FnZTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENyZWFyIGVsIGRpdiBkZSBsYSBhbGVydGFcbiAgICBjb25zdCBhbGVydE1lc3NhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBwYCk7XG4gICAgYWxlcnRNZXNzYWdlLmNsYXNzTGlzdC5hZGQoYGFsZXJ0YCk7XG5cbiAgICAvLyBBZ3JlZ2FyIGVsIG1lbnNhamUgeSBlbCB0aXBvIGRlIGFsZXJ0YSBhbCBwIGRlIGxhIGFsZXJ0YVxuICAgIGlmICh0eXBlQWxlcnQgPT09IGBlcnJvcmApIHtcbiAgICAgIGFsZXJ0TWVzc2FnZS5jbGFzc0xpc3QuYWRkKGBhbGVydC0tZXJyb3JgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWxlcnRNZXNzYWdlLmNsYXNzTGlzdC5hZGQoYGFsZXJ0LS1zdWNjZXNzYCk7XG4gICAgfVxuXG4gICAgLy8gQWdyZWdhciBhbCBkaXYgZWwgbWVuc2FqZVxuICAgIGFsZXJ0TWVzc2FnZS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG5cbiAgICAvLyBJbnNlcnRhciBsYSBhbGVydGEgYWwgSFRNTFxuICAgIGNvbnN0IGJ1ZGdldEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjYnVkZ2V0Rm9ybWApO1xuICAgIGJ1ZGdldEZvcm0uYXBwZW5kQ2hpbGQoYWxlcnRNZXNzYWdlKTtcblxuICAgIC8vIEVsaW1pbmFyIGxhIGFsZXJ0YSBkZXNwdcOpcyBkZSAzIHNlZ3VuZG9zXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBhbGVydE1lc3NhZ2UucmVtb3ZlKCk7XG4gICAgfSwgMjAwMCk7XG4gIH1cblxuICBzaG93RXhwZW5zZUxpc3QoZXhwZW5zZXMpIHtcbiAgICAvLyBMaW1waWFyIGxhIGxpc3RhIGRlIGdhc3Rvc1xuICAgIHRoaXMuY2xlYW5IdG1sKCk7XG5cbiAgICAvLyBJdGVyYXIgbG9zIGdhc3Rvc1xuICAgIGV4cGVuc2VzLmZvckVhY2goKGV4cGVuc2UpID0+IHtcbiAgICAgIGNvbnN0IHsgaW5wdXROYW1lLCBpbnB1dEFtb3VudCwgc2VsZWN0ZWRDYXRlZ29yeSwgaWQgfSA9IGV4cGVuc2U7XG5cbiAgICAgIC8vIEZvcm1hdGVhciBsYSBjYW50aWRhZFxuICAgICAgY29uc3QgZm9ybWF0dGVkQW1vdW50ID0gaW5wdXRBbW91bnQudG9Mb2NhbGVTdHJpbmcoXCJlcy1NWFwiLCB7XG4gICAgICAgIHN0eWxlOiBcImN1cnJlbmN5XCIsXG4gICAgICAgIGN1cnJlbmN5OiBcIk1YTlwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENyZWFyIGVsIExpXG4gICAgICBjb25zdCBleHBlbnNlSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGxpYCk7XG4gICAgICBleHBlbnNlSXRlbS5jbGFzc05hbWUgPSBgZXhwZW5zZS1pdGVtYDtcbiAgICAgIGV4cGVuc2VJdGVtLmRhdGFzZXQuaWQgPSBpZDtcbiAgICAgIGV4cGVuc2VJdGVtLmRhdGFzZXQuY2F0ZWdvcnkgPSBzZWxlY3RlZENhdGVnb3J5O1xuXG4gICAgICAvLyBBZ3JlZ2FyIGVsIEhUTUxcbiAgICAgIGV4cGVuc2VJdGVtLmlubmVySFRNTCA9IGBcbiAgICAgICAgPGRpdiBjbGFzcz1cImV4cGVuc2UtaXRlbV9fdGV4dHNcIj5cbiAgICAgICAgICA8cCBjbGFzcz1cImV4cGVuc2UtaXRlbV9fZGVzY3JpcHRpb25cIj4ke2lucHV0TmFtZX08L3A+XG4gICAgICAgICAgPHAgY2xhc3M9XCJleHBlbnNlLWl0ZW1fX3ByaWNlXCI+JHtmb3JtYXR0ZWRBbW91bnR9PC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG5cbiAgICAgIC8vIEJvdMOzbiBwYXJhIGJvcnJhciBlbCBnYXN0b1xuICAgICAgY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgYnV0dG9uYCk7XG4gICAgICBkZWxldGVCdG4uY2xhc3NMaXN0LmFkZChgZXhwZW5zZS1pdGVtX19idG5gKTtcbiAgICAgIGRlbGV0ZUJ0bi50ZXh0Q29udGVudCA9IGBYYDtcbiAgICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKGBjbGlja2AsICgpID0+IHtcbiAgICAgICAgZGVsZXRlRXhwZW5zZShpZCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQcOxYWRpciBlbCBib3TDs24gYWwgTGlcbiAgICAgIGV4cGVuc2VJdGVtLmFwcGVuZENoaWxkKGRlbGV0ZUJ0bik7XG5cbiAgICAgIC8vIEHDsWFkaXIgZWwgTGkgYWwgVWxcbiAgICAgIGV4cGVuc2VzTGlzdC5hcHBlbmRDaGlsZChleHBlbnNlSXRlbSk7XG4gICAgfSk7XG4gIH1cblxuICBjbGVhbkh0bWwoKSB7XG4gICAgd2hpbGUgKGV4cGVuc2VzTGlzdC5maXJzdENoaWxkKSB7XG4gICAgICBleHBlbnNlc0xpc3QucmVtb3ZlQ2hpbGQoZXhwZW5zZXNMaXN0LmZpcnN0Q2hpbGQpO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZUF2YWlsYWJsZUJ1ZGdldChhdmFpbGFibGUsIHNwZW50KSB7XG4gICAgbGV0IGZvcm1hdHRlZEF2YWlsYWJsZSA9IGF2YWlsYWJsZS50b0xvY2FsZVN0cmluZyhcImVzLU1YXCIsIHtcbiAgICAgIHN0eWxlOiBcImN1cnJlbmN5XCIsXG4gICAgICBjdXJyZW5jeTogXCJNWE5cIixcbiAgICB9KTtcbiAgICBsZXQgZm9ybWF0dGVkU3BlbnQgPSBzcGVudC50b0xvY2FsZVN0cmluZyhcImVzLU1YXCIsIHtcbiAgICAgIHN0eWxlOiBcImN1cnJlbmN5XCIsXG4gICAgICBjdXJyZW5jeTogXCJNWE5cIixcbiAgICB9KTtcblxuICAgIC8vIEFjdHVhbGl6YXIgZWwgZGlzcG9uaWJsZSB5IGVsIGdhc3RhZG8gZW4gZWwgSFRNTFxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI2J1ZGdldENhcmRBdmFpbGFibGVgXG4gICAgKS50ZXh0Q29udGVudCA9IGAke2Zvcm1hdHRlZEF2YWlsYWJsZX1gO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI2J1ZGdldENhcmRTcGVudGBcbiAgICApLnRleHRDb250ZW50ID0gYCR7Zm9ybWF0dGVkU3BlbnR9YDtcbiAgfVxuXG4gIGNoZWNrQnVkZ2V0KGJ1ZGdldE9iaikge1xuICAgIGNvbnN0IHsgYnVkZ2V0VG90YWwsIGJ1ZGdldEF2YWlsYWJsZSB9ID0gYnVkZ2V0T2JqO1xuXG4gICAgLyogICBpZiAoYnVkZ2V0VG90YWwgLyA0ID4gYnVkZ2V0QXZhaWxhYmxlKSB7XG4gICAgICBjb25zb2xlLmxvZyhgR2FzdGFzdGUgZWwgNzUlYCk7XG4gICAgfSBlbHNlIGlmIChidWRnZXRUb3RhbCAvIDIgPiBidWRnZXRBdmFpbGFibGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGBHYXN0YXN0ZSBlbCA1MCVgKTtcbiAgICB9ICovXG5cbiAgICBjb25zdCBidWRnZXRGb3JtQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmJ1ZGdldC1mb3JtX19idG5gKTtcblxuICAgIC8vIERlc2FjdGl2YXIgZWwgYm90w7NuIGRlIGFncmVnYXIgZ2FzdG8gc2kgZWwgcHJlc3VwdWVzdG8gZXN0w6EgYWdvdGFkb1xuICAgIGlmIChidWRnZXRBdmFpbGFibGUgPD0gMCkge1xuICAgICAgdXNlckludGVyZmFjZS5wcmludEFsZXJ0cyhgRWwgcHJlc3VwdWVzdG8gc2UgaGEgYWdvdGFkb2AsIGBlcnJvcmApO1xuICAgICAgYnVkZ2V0Rm9ybUJ0bi5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1ZGdldEZvcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cbn1cblxuLyogSW5zdGFuY2lhcyAqL1xubGV0IGJ1ZGdldDtcbmNvbnN0IHVzZXJJbnRlcmZhY2UgPSBuZXcgVXNlckludGVyZmFjZSgpO1xuXG4vKiBGdW5jaW9uZXMgKi9cblxuZnVuY3Rpb24gbG9hZExvY2FsU3RvcmFnZSgpIHtcbiAgbGV0IHVzZXJOYW1lID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdXNlcm5hbWVgKSk7XG4gIGJ1ZGdldCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oYGJ1ZGdldGApKTtcblxuICAvLyBTaSBleGlzdGUgZWwgbm9tYnJlIGRlIHVzdWFyaW8sIGltcHJpbWUgbG9zIGRhdG9zIGVuIGxhIFVJXG4gIGlmICh1c2VyTmFtZSkge1xuICAgIHVzZXJJbnRlcmZhY2UuaW5zZXJ0TmFtZSh1c2VyTmFtZSk7XG4gIH0gZWxzZSB7XG4gICAgLy8gUGVkaXIgZWwgbm9tYnJlIGRlbCB1c3VhcmlvXG4gICAgcmVxdWVzdE5hbWUodXNlck5hbWUpO1xuICB9XG5cbiAgLy8gU2kgZXhpc3RlIGVsIHByZXN1cHVlc3RvLCBjYXJnYXIgbG9zIGdhc3RvcyBlbiBsYSBVSVxuICBpZiAoYnVkZ2V0KSB7XG4gICAgY29uc3QgeyBidWRnZXRUb3RhbCwgYnVkZ2V0QXZhaWxhYmxlLCBidWRnZXRTcGVudCwgZXhwZW5zZXMgfSA9IGJ1ZGdldDtcblxuICAgIGNvbnNvbGUubG9nKGJ1ZGdldCk7XG4gICAgLy8gSW5zdGFuY2lhciBlbCBvYmpldG8gZGUgcHJlc3VwdWVzdG9cbiAgICBidWRnZXQgPSBuZXcgQnVkZ2V0KGJ1ZGdldFRvdGFsKTtcbiAgICBjb25zb2xlLmxvZyhidWRnZXQpO1xuXG4gICAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBpbnNlcnRhciBlbCBwcmVzdXB1ZXN0byBlbiBsYSBVSVxuICAgIHVzZXJJbnRlcmZhY2UuaW5zZXJ0QnVkZ2V0KGJ1ZGdldCk7XG5cblxuICAgIGxvYWRFeHBlbnNlc1RvTG9jYWxTdG9yYWdlKGJ1ZGdldEF2YWlsYWJsZSwgYnVkZ2V0U3BlbnQsIGV4cGVuc2VzKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBQZWRpciBlbCBwcmVzdXB1ZXN0byBhbCB1c3VhcmlvXG4gICAgcmVxdWVzdEJ1ZGdldCgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGxvYWRFeHBlbnNlc1RvTG9jYWxTdG9yYWdlKGJ1ZGdldEF2YWlsYWJsZSwgYnVkZ2V0U3BlbnQsIGV4cGVuc2VzKSB7XG4gIC8vIExsYW1hciBhbCBtw6l0b2RvIHBhcmEgaW5zZXJ0YXIgbG9zIGdhc3RvcyBlbiBsYSBVSVxuICB1c2VySW50ZXJmYWNlLnNob3dFeHBlbnNlTGlzdChleHBlbnNlcyk7XG5cbiAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBhY3R1YWxpemFyIGVsIHByZXN1cHVlc3RvIGRpc3BvbmlibGUgeSBnYXN0YWRvIGVuIGxhIFVJXG4gIHVzZXJJbnRlcmZhY2UudXBkYXRlQXZhaWxhYmxlQnVkZ2V0KGJ1ZGdldEF2YWlsYWJsZSwgYnVkZ2V0U3BlbnQpO1xuXG4gIC8vIExsYW1hciBhbCBtw6l0b2RvIHBhcmEgdmVyaWZpY2FyIGVsIHByZXN1cHVlc3RvIGVuIGxhIFVJXG4gIHVzZXJJbnRlcmZhY2UuY2hlY2tCdWRnZXQoYnVkZ2V0KTtcbn1cblxuZnVuY3Rpb24gcmVxdWVzdE5hbWUodXNlck5hbWUpIHtcbiAgLy8gU29saWNpdGFyIGVsIG5vbWJyZSBkZWwgdXN1YXJpbyBoYXN0YSBxdWUgc2UgaW5ncmVzZSB1biB2YWxvciB2w6FsaWRvXG4gIGRvIHtcbiAgICB1c2VyTmFtZSA9IHByb21wdChgwr9DdcOhbCBlcyB0dSBub21icmU/YCk7XG5cbiAgICAvLyBWYWxpZGFyIGVsIG5vbWJyZVxuICAgIGlmICghdXNlck5hbWUpIHtcbiAgICAgIGFsZXJ0KGBQb3IgZmF2b3IsIGludHJvZHVjZSB1biBub21icmUgdsOhbGlkby5gKTtcbiAgICB9XG4gIH0gd2hpbGUgKCF1c2VyTmFtZSk7XG5cbiAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBpbnNlcnRhciBlbCBub21icmUgZW4gbGEgVUlcbiAgdXNlckludGVyZmFjZS5pbnNlcnROYW1lKHVzZXJOYW1lKTtcblxuICAvLyBHdWFyZGFyIGVsIG5vbWJyZSBlbiBlbCBMb2NhbFN0b3JhZ2VcbiAgc2F2ZVRvTG9jYWxTdG9yYWdlKGB1c2VybmFtZWAsIHVzZXJOYW1lKTtcbn1cblxuZnVuY3Rpb24gcmVxdWVzdEJ1ZGdldCgpIHtcbiAgY29uc3QgdXNlckJ1ZGdldCA9IE51bWJlcihwcm9tcHQoYMK/Q3XDoWwgZXMgdHUgcHJlc3VwdWVzdG8/YCkpO1xuICBjb25zdCB2b2lkVmFsdWUgPSBgYDtcblxuICBpZiAoXG4gICAgdXNlckJ1ZGdldCA9PT0gdm9pZFZhbHVlIHx8XG4gICAgdXNlckJ1ZGdldCA9PT0gbnVsbCB8fFxuICAgIGlzTmFOKHVzZXJCdWRnZXQpIHx8XG4gICAgdXNlckJ1ZGdldCA8PSAwXG4gICkge1xuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgfVxuXG4gIC8vIENyZWFyIGluc3RhbmNpYSBkZSBcIkJ1ZGdldFwiIHkgZXN0YWJsZWNlcmxvXG4gIGJ1ZGdldCA9IG5ldyBCdWRnZXQodXNlckJ1ZGdldCk7XG5cbiAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBpbnNlcnRhciBlbCBwcmVzdXB1ZXN0byBlbiBsYSBVSVxuICB1c2VySW50ZXJmYWNlLmluc2VydEJ1ZGdldChidWRnZXQpO1xuXG4gIC8vIEd1YXJkYXIgZWwgb2JqZXRvIGRlIHByZXN1cHVlc3RvIGVuIGVsIGxvY2FsU3RvcmFnZVxuICBzYXZlVG9Mb2NhbFN0b3JhZ2UoYGJ1ZGdldGAsIGJ1ZGdldCk7XG59XG5cbmZ1bmN0aW9uIGJ1ZGdldEZvcm1FdmVudHMoKSB7XG4gIC8vIE9idGVuZXIgZWwgZm9ybXVsYXJpbyB5IHN1cyBldmVudG9zXG4gIGNvbnN0IGJ1ZGdldEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjYnVkZ2V0Rm9ybWApO1xuICBidWRnZXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoYHN1Ym1pdGAsIGFkZEV4cGVuc2UpO1xufVxuXG5mdW5jdGlvbiBhZGRFeHBlbnNlKGUpIHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIC8vIE9idGVuZXIgbG9zIHZhbG9yZXMgZGVsIGZvcm11bGFyaW9cbiAgY29uc3QgaW5wdXROYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2J1ZGdldEZvcm1OYW1lYCkudmFsdWU7XG4gIGNvbnN0IGlucHV0QW1vdW50ID0gTnVtYmVyKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNidWRnZXRGb3JtQW1vdW50YCkudmFsdWUpO1xuICBjb25zdCBzZWxlY3RlZENhdGVnb3J5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2J1ZGdldEZvcm1DYXRlZ29yeWApLnZhbHVlO1xuICBsZXQgdm9pZFZhbHVlID0gYGA7XG5cbiAgLy8gVmFsaWRhciBxdWUgbmluZ3VubyBkZSBsb3MgY2FtcG9zIGVzdMOpIHZhY8Otb1xuICBpZiAoXG4gICAgaW5wdXROYW1lID09PSB2b2lkVmFsdWUgfHxcbiAgICBpbnB1dEFtb3VudCA9PT0gdm9pZFZhbHVlIHx8XG4gICAgc2VsZWN0ZWRDYXRlZ29yeSA9PT0gdm9pZFZhbHVlXG4gICkge1xuICAgIHVzZXJJbnRlcmZhY2UucHJpbnRBbGVydHMoYFRvZG9zIGxvcyBjYW1wb3Mgc29uIG9ibGlnYXRvcmlvc2AsIGBlcnJvcmApO1xuXG4gICAgcmV0dXJuO1xuICB9IGVsc2UgaWYgKGlucHV0QW1vdW50IDw9IDAgfHwgaXNOYU4oaW5wdXRBbW91bnQpKSB7XG4gICAgdXNlckludGVyZmFjZS5wcmludEFsZXJ0cyhgQ2FudGlkYWQgbm8gdmFsaWRhYCwgYGVycm9yYCk7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBDcmVhciBvYmpldG8gY29uIGVsIGdhc3RvXG4gIGNvbnN0IGV4cGVuc2UgPSB7IGlucHV0TmFtZSwgaW5wdXRBbW91bnQsIHNlbGVjdGVkQ2F0ZWdvcnksIGlkOiBEYXRlLm5vdygpIH07XG5cbiAgLy8gQcOxYWRpciBlbCBnYXN0byBhIGxhIGxpc3RhIHkgYWwgcHJlc3VwdWVzdG9cbiAgYnVkZ2V0Lm5ld0V4cGVuc2VzKGV4cGVuc2UpO1xuXG4gIC8vIE9idGVuZXIgbG9zIHZhbG9yZXMgYWN0dWFsZXMgZGVsIHByZXN1cHVlc3RvIHkgZ2FzdG9cbiAgY29uc3QgeyBleHBlbnNlcywgYnVkZ2V0QXZhaWxhYmxlLCBidWRnZXRTcGVudCB9ID0gYnVkZ2V0O1xuXG4gIC8vIEltcHJpbWlyIGVsIGdhc3RvIGVuIGVsIEhUTUxcbiAgdXNlckludGVyZmFjZS5zaG93RXhwZW5zZUxpc3QoZXhwZW5zZXMpO1xuXG4gIC8vIEFjdHVhbGl6YXIgZWwgcHJlc3VwdWVzdG8gZW4gbGEgVUlcbiAgdXNlckludGVyZmFjZS51cGRhdGVBdmFpbGFibGVCdWRnZXQoYnVkZ2V0QXZhaWxhYmxlLCBidWRnZXRTcGVudCk7XG5cbiAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBjb21wcm9iYXIgc2kgc2UgaGEgYWxjYW56YWRvIGVsIHByZXN1cHVlc3RvXG4gIHVzZXJJbnRlcmZhY2UuY2hlY2tCdWRnZXQoYnVkZ2V0KTtcblxuICAvLyBMaW1waWFyIGxvcyBjYW1wb3MgZGVsIGZvcm11bGFyaW9cbiAgY29uc3QgYnVkZ2V0Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCNidWRnZXRGb3JtYCk7XG4gIGJ1ZGdldEZvcm0ucmVzZXQoKTtcblxuICAvLyBHdWFyZGEgZWwgb2JqZXRvIGJ1ZGdldCBhY3R1YWxpemFkbyBlbiBlbCBsb2NhbFN0b3JhZ2VcbiAgc2F2ZVRvTG9jYWxTdG9yYWdlKGBidWRnZXRgLCBidWRnZXQpO1xufVxuXG5mdW5jdGlvbiBkZWxldGVFeHBlbnNlKGlkKSB7XG4gIC8vIEVsaW1pbmFyIGVsIGdhc3RvIGRlbCBvYmpldG9cbiAgYnVkZ2V0LmRlbGV0ZUV4cGVuc2UoaWQpO1xuXG4gIC8vIE9idGVuZXIgbG9zIHZhbG9yZXMgYWN0dWFsZXMgZGVsIHByZXN1cHVlc3RvIHkgZ2FzdG9cbiAgY29uc3QgeyBleHBlbnNlcywgYnVkZ2V0QXZhaWxhYmxlLCBidWRnZXRTcGVudCB9ID0gYnVkZ2V0O1xuXG4gIC8vIEVsaW1pbmFyIGVsIGdhc3RvIGRlbCBIVE1MXG4gIHVzZXJJbnRlcmZhY2Uuc2hvd0V4cGVuc2VMaXN0KGV4cGVuc2VzKTtcblxuICAvLyBBY3R1YWxpemFyIGVsIHByZXN1cHVlc3RvIGVuIGxhIFVJXG4gIHVzZXJJbnRlcmZhY2UudXBkYXRlQXZhaWxhYmxlQnVkZ2V0KGJ1ZGdldEF2YWlsYWJsZSwgYnVkZ2V0U3BlbnQpO1xuXG4gIC8vIExsYW1hciBhbCBtw6l0b2RvIHBhcmEgY29tcHJvYmFyIHNpIHNlIGhhIGFsY2FuemFkbyBlbCBwcmVzdXB1ZXN0b1xuICB1c2VySW50ZXJmYWNlLmNoZWNrQnVkZ2V0KGJ1ZGdldCk7XG5cbiAgLy8gR3VhcmRhIGVsIG9iamV0byBidWRnZXQgYWN0dWFsaXphZG8gZW4gZWwgbG9jYWxTdG9yYWdlXG4gIHNhdmVUb0xvY2FsU3RvcmFnZShgYnVkZ2V0YCwgYnVkZ2V0KTtcbn1cblxuZnVuY3Rpb24gc2F2ZVRvTG9jYWxTdG9yYWdlKGtleSwgdmFsdWUpIHtcbiAgLy8gR3VhcmRhciBkYXRvcyBlbiBlbCBMb2NhbFN0b3JhZ2VcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xufVxuIl19
