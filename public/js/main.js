const expensesList=document.querySelector("#expensesList");function startApp(){loadLocalStorage(),budgetFormEvents()}document.addEventListener("DOMContentLoaded",startApp);class Budget{constructor(e){this.budgetTotal=e,this.budgetAvailable=e,this.budgetSpent=0,this.expenses=[]}newExpenses(e){e.inputAmount>this.budgetAvailable?userInterface.printAlerts("No tienes fondos suficientes","error"):(this.expenses=[...this.expenses,e],this.calculateSpent(),userInterface.printAlerts("Se agregó correctamente","success"))}calculateSpent(){this.budgetSpent=this.expenses.reduce((e,t)=>e+t.inputAmount,0),this.budgetAvailable=this.budgetTotal-this.budgetSpent}deleteExpense(e){const t=this.expenses.filter(t=>t.id!==e);this.expenses=t,this.calculateSpent()}}class UserInterface{insertName(e){document.querySelector(".budget__heading--user-name").textContent=e+"!"}insertBudget(e){const{budgetTotal:t,budgetAvailable:n,budgetSpent:s}=e;let r=t.toLocaleString("es-MX",{style:"currency",currency:"MXN"}),u=n.toLocaleString("es-MX",{style:"currency",currency:"MXN"}),a=s.toLocaleString("es-MX",{style:"currency",currency:"MXN"});document.querySelector("#budgetCardTotal").textContent=""+r,document.querySelector("#budgetCardAvailable").textContent=""+u,document.querySelector("#budgetCardSpent").textContent=""+a}printAlerts(e,t){let n=document.querySelector(".alert--"+t);if(n)return void(n.textContent=e);const s=document.createElement("p");s.classList.add("alert"),"error"===t?s.classList.add("alert--error"):s.classList.add("alert--success"),s.textContent=e;document.querySelector("#budgetForm").appendChild(s),setTimeout(()=>{s.remove()},2e3)}showExpenseList(e){this.cleanHtml(),e.forEach(e=>{const{inputName:t,inputAmount:n,selectedCategory:s,id:r}=e,u=n.toLocaleString("es-MX",{style:"currency",currency:"MXN"}),a=document.createElement("li");a.className="expense-item",a.dataset.id=r,a.dataset.category=s,a.innerHTML=`\n        <div class="expense-item__texts">\n          <p class="expense-item__description">${t}</p>\n          <p class="expense-item__price">${u}</p>\n        </div>\n      `;const o=document.createElement("button");o.classList.add("expense-item__btn"),o.textContent="X",o.addEventListener("click",()=>{deleteExpense(r)}),a.appendChild(o),expensesList.appendChild(a)})}cleanHtml(){for(;expensesList.firstChild;)expensesList.removeChild(expensesList.firstChild)}updateAvailableBudget(e,t){let n=e.toLocaleString("es-MX",{style:"currency",currency:"MXN"}),s=t.toLocaleString("es-MX",{style:"currency",currency:"MXN"});document.querySelector("#budgetCardAvailable").textContent=""+n,document.querySelector("#budgetCardSpent").textContent=""+s}checkBudget(e){const{budgetTotal:t,budgetAvailable:n}=e,s=document.querySelector(".budget-form__btn");n<=0?(userInterface.printAlerts("El presupuesto se ha agotado","error"),s.disabled=!0):s.disabled=!1}}let budget;const userInterface=new UserInterface;function loadLocalStorage(){let e=JSON.parse(localStorage.getItem("username")),t=JSON.parse(localStorage.getItem("budget"));if(e?userInterface.insertName(e):requestName(e),t){const{budgetTotal:e,budgetAvailable:n,budgetSpent:s,expenses:r}=t;budget=new Budget(e),budget.budgetAvailable=n,budget.budgetSpent=s,budget.expenses=r,userInterface.insertBudget(budget),loadExpensesToLocalStorage()}else requestBudget()}function loadExpensesToLocalStorage(){const{budgetAvailable:e,budgetSpent:t,expenses:n}=budget;userInterface.showExpenseList(n),userInterface.updateAvailableBudget(e,t),userInterface.checkBudget(budget)}function requestName(e){do{(e=prompt("¿Cuál es tu nombre?"))||alert("Por favor, introduce un nombre válido.")}while(!e);userInterface.insertName(e),saveToLocalStorage("username",e)}function requestBudget(){const e=Number(prompt("¿Cuál es tu presupuesto?"));(""===e||null===e||isNaN(e)||e<=0)&&window.location.reload(),budget=new Budget(e),userInterface.insertBudget(budget),saveToLocalStorage("budget",budget)}function budgetFormEvents(){document.querySelector("#budgetForm").addEventListener("submit",addExpense)}function addExpense(e){e.preventDefault();const t=document.querySelector("#budgetFormName").value,n=Number(document.querySelector("#budgetFormAmount").value),s=document.querySelector("#budgetFormCategory").value;if(""===t||""===n||""===s)return void userInterface.printAlerts("Todos los campos son obligatorios","error");if(n<=0||isNaN(n))return void userInterface.printAlerts("Cantidad no valida","error");const r={inputName:t,inputAmount:n,selectedCategory:s,id:Date.now()};budget.newExpenses(r);const{expenses:u,budgetAvailable:a,budgetSpent:o}=budget;userInterface.showExpenseList(u),userInterface.updateAvailableBudget(a,o),userInterface.checkBudget(budget);document.querySelector("#budgetForm").reset(),saveToLocalStorage("budget",budget)}function deleteExpense(e){budget.deleteExpense(e);const{expenses:t,budgetAvailable:n,budgetSpent:s}=budget;userInterface.showExpenseList(t),userInterface.updateAvailableBudget(n,s),userInterface.checkBudget(budget),saveToLocalStorage("budget",budget)}function saveToLocalStorage(e,t){localStorage.setItem(e,JSON.stringify(t))}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZXhwZW5zZXNMaXN0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic3RhcnRBcHAiLCJsb2FkTG9jYWxTdG9yYWdlIiwiYnVkZ2V0Rm9ybUV2ZW50cyIsImFkZEV2ZW50TGlzdGVuZXIiLCJCdWRnZXQiLCJbb2JqZWN0IE9iamVjdF0iLCJidWRnZXRUb3RhbCIsInRoaXMiLCJidWRnZXRBdmFpbGFibGUiLCJidWRnZXRTcGVudCIsImV4cGVuc2VzIiwiZXhwZW5zZSIsImlucHV0QW1vdW50IiwidXNlckludGVyZmFjZSIsInByaW50QWxlcnRzIiwiY2FsY3VsYXRlU3BlbnQiLCJyZWR1Y2UiLCJ0b3RhbCIsImV4cGVuc2VJZCIsImZpbHRlcmVkRXhwZW5zZXMiLCJmaWx0ZXIiLCJpZCIsIlVzZXJJbnRlcmZhY2UiLCJ1c2VyTmFtZSIsInRleHRDb250ZW50IiwicXVhbnRpdHkiLCJmb3JtYXR0ZWRUb3RhbCIsInRvTG9jYWxlU3RyaW5nIiwic3R5bGUiLCJjdXJyZW5jeSIsImZvcm1hdHRlZEF2YWlsYWJsZSIsImZvcm1hdHRlZFNwZW50IiwibWVzc2FnZSIsInR5cGVBbGVydCIsImV4aXN0aW5nQWxlcnQiLCJhbGVydE1lc3NhZ2UiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJzZXRUaW1lb3V0IiwicmVtb3ZlIiwiY2xlYW5IdG1sIiwiZm9yRWFjaCIsImlucHV0TmFtZSIsInNlbGVjdGVkQ2F0ZWdvcnkiLCJmb3JtYXR0ZWRBbW91bnQiLCJleHBlbnNlSXRlbSIsImNsYXNzTmFtZSIsImRhdGFzZXQiLCJjYXRlZ29yeSIsImlubmVySFRNTCIsImRlbGV0ZUJ0biIsImRlbGV0ZUV4cGVuc2UiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJhdmFpbGFibGUiLCJzcGVudCIsImJ1ZGdldE9iaiIsImJ1ZGdldEZvcm1CdG4iLCJkaXNhYmxlZCIsImJ1ZGdldCIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJidWRnZXREYXRhIiwiaW5zZXJ0TmFtZSIsInJlcXVlc3ROYW1lIiwiaW5zZXJ0QnVkZ2V0IiwibG9hZEV4cGVuc2VzVG9Mb2NhbFN0b3JhZ2UiLCJyZXF1ZXN0QnVkZ2V0Iiwic2hvd0V4cGVuc2VMaXN0IiwidXBkYXRlQXZhaWxhYmxlQnVkZ2V0IiwiY2hlY2tCdWRnZXQiLCJwcm9tcHQiLCJhbGVydCIsInNhdmVUb0xvY2FsU3RvcmFnZSIsInVzZXJCdWRnZXQiLCJOdW1iZXIiLCJpc05hTiIsIndpbmRvdyIsImxvY2F0aW9uIiwicmVsb2FkIiwiYWRkRXhwZW5zZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwiRGF0ZSIsIm5vdyIsIm5ld0V4cGVuc2VzIiwicmVzZXQiLCJrZXkiLCJzZXRJdGVtIiwic3RyaW5naWZ5Il0sIm1hcHBpbmdzIjoiQUFDQSxNQUFNQSxhQUFlQyxTQUFTQyxjQUFjLGlCQUs1QyxTQUFTQyxXQUNQQyxtQkFDQUMsbUJBSkZKLFNBQVNLLGlCQUFpQixtQkFBb0JILFVBUTlDLE1BQU1JLE9BQ0pDLFlBQVlDLEdBQ1ZDLEtBQUtELFlBQWNBLEVBQ25CQyxLQUFLQyxnQkFBa0JGLEVBQ3ZCQyxLQUFLRSxZQUFjLEVBQ25CRixLQUFLRyxTQUFXLEdBR2xCTCxZQUFZTSxHQUVOQSxFQUFRQyxZQUFjTCxLQUFLQyxnQkFDN0JLLGNBQWNDLFlBQVksK0JBQWdDLFVBTTVEUCxLQUFLRyxTQUFXLElBQUlILEtBQUtHLFNBQVVDLEdBQ25DSixLQUFLUSxpQkFHTEYsY0FBY0MsWUFBWSwwQkFBMkIsWUFHdkRULGlCQUNFRSxLQUFLRSxZQUFjRixLQUFLRyxTQUFTTSxPQUMvQixDQUFDQyxFQUFPTixJQUFZTSxFQUFRTixFQUFRQyxZQUNwQyxHQUVGTCxLQUFLQyxnQkFBa0JELEtBQUtELFlBQWNDLEtBQUtFLFlBR2pESixjQUFjYSxHQUVaLE1BQU1DLEVBQW1CWixLQUFLRyxTQUFTVSxPQUNwQ1QsR0FBWUEs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akUsR0FBSUYsR0FBZSxHQUFLb0UsTUFBTXBFLEdBRzVCLFlBRkFDLGNBQWNDLFlBQVkscUJBQXNCLFNBTWxELE1BQU1ILEVBQVUsQ0FBRWlDLFVBQUFBLEVBQVdoQyxZQUFBQSxFQUFhaUMsaUJBQUFBLEVBQWtCeEIsR0FBSW1FLEtBQUtDLE9BR3JFNUIsT0FBTzZCLFlBQVkvRSxHQUduQixNQUFNRCxTQUFFQSxFQUFRRixnQkFBRUEsRUFBZUMsWUFBRUEsR0FBZ0JvRCxPQUduRGhELGNBQWMyRCxnQkFBZ0I5RCxHQUc5QkcsY0FBYzRELHNCQUFzQmpFLEVBQWlCQyxHQUdyREksY0FBYzZELFlBQVliLFFBR1AvRCxTQUFTQyxjQUFjLGVBQy9CNEYsUUFHWGQsbUJBQW1CLFNBQVVoQixRQUcvQixTQUFTUixjQUFjaEMsR0FFckJ3QyxPQUFPUixjQUFjaEMsR0FHckIsTUFBTVgsU0FBRUEsRUFBUUYsZ0JBQUVBLEVBQWVDLFlBQUVBLEdBQWdCb0QsT0FHbkRoRCxjQUFjMkQsZ0JBQWdCOUQsR0FHOUJHLGNBQWM0RCxzQkFBc0JqRSxFQUFpQkMsR0FHckRJLGNBQWM2RCxZQUFZYixRQUcxQmdCLG1CQUFtQixTQUFVaEIsUUFHL0IsU0FBU2dCLG1CQUFtQmUsRUFBS0wsR0FFL0J2QixhQUFhNkIsUUFBUUQsRUFBSzlCLEtBQUtnQyxVQUFVUCIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogVmFyaWFibGVzIHkgc2VsZWN0b3JlcyAqL1xuY29uc3QgZXhwZW5zZXNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2V4cGVuc2VzTGlzdGApO1xuXG4vKiBFdmVudG9zICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKGBET01Db250ZW50TG9hZGVkYCwgc3RhcnRBcHApO1xuXG5mdW5jdGlvbiBzdGFydEFwcCgpIHtcbiAgbG9hZExvY2FsU3RvcmFnZSgpO1xuICBidWRnZXRGb3JtRXZlbnRzKCk7XG59XG5cbi8qIENsYXNlcyAqL1xuY2xhc3MgQnVkZ2V0IHtcbiAgY29uc3RydWN0b3IoYnVkZ2V0VG90YWwpIHtcbiAgICB0aGlzLmJ1ZGdldFRvdGFsID0gYnVkZ2V0VG90YWw7XG4gICAgdGhpcy5idWRnZXRBdmFpbGFibGUgPSBidWRnZXRUb3RhbDtcbiAgICB0aGlzLmJ1ZGdldFNwZW50ID0gMDtcbiAgICB0aGlzLmV4cGVuc2VzID0gW107XG4gIH1cblxuICBuZXdFeHBlbnNlcyhleHBlbnNlKSB7XG4gICAgLy8gVmFsaWRhciBxdWUgZWwgbW9udG8gaW50cm9kdWNpZG8gbm8gc2VhIG1heW9yIGFsIHByZXN1cHVlc3RvIGRpc3BvbmlibGVcbiAgICBpZiAoZXhwZW5zZS5pbnB1dEFtb3VudCA+IHRoaXMuYnVkZ2V0QXZhaWxhYmxlKSB7XG4gICAgICB1c2VySW50ZXJmYWNlLnByaW50QWxlcnRzKGBObyB0aWVuZXMgZm9uZG9zIHN1ZmljaWVudGVzYCwgYGVycm9yYCk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBBw7FhZGlyIGVsIGdhc3RvIGEgbGEgbGlzdGEgZGUgZ2FzdG9zXG4gICAgdGhpcy5leHBlbnNlcyA9IFsuLi50aGlzLmV4cGVuc2VzLCBleHBlbnNlXTtcbiAgICB0aGlzLmNhbGN1bGF0ZVNwZW50KCk7XG5cbiAgICAvLyBJbXByaW1pciB1bmEgYWxlcnRhIGRlIGV4aXRvXG4gICAgdXNlckludGVyZmFjZS5wcmludEFsZXJ0cyhgU2UgYWdyZWfDsyBjb3JyZWN0YW1lbnRlYCwgYHN1Y2Nlc3NgKTtcbiAgfVxuXG4gIGNhbGN1bGF0ZVNwZW50KCkge1xuICAgIHRoaXMuYnVkZ2V0U3BlbnQgPSB0aGlzLmV4cGVuc2VzLnJlZHVjZShcbiAgICAgICh0b3RhbCwgZXhwZW5zZSkgPT4gdG90YWwgKyBleHBlbnNlLmlucHV0QW1vdW50LFxuICAgICAgMFxuICAgICk7XG4gICAgdGhpcy5idWRnZXRBdmFpbGFibGUgPSB0aGlzLmJ1ZGdldFRvdGFsIC0gdGhpcy5idWRnZXRTcGVudDtcbiAgfVxuXG4gIGRlbGV0ZUV4cGVuc2UoZXhwZW5zZUlkKSB7XG4gICAgLy8gRmlsdHJhciBsb3MgZ2FzdG9zIHF1ZSBubyB0aWVuZW4gZWwgaWQgZGUgZXhwZW5zZXNJZFxuICAgIGNvbnN0IGZpbHRlcmVkRXhwZW5zZXMgPSB0aGlzLmV4cGVuc2VzLmZpbHRlcihcbiAgICAgIChleHBlbnNlKSA9PiBleHBlbnNlLmlkICE9PSBleHBlbnNlSWRcbiAgICApO1xuXG4gICAgLy8gQWN0dWFsaXphciBlbCBhcnJheSBkZSBnYXN0b3NcbiAgICB0aGlzLmV4cGVuc2VzID0gZmlsdGVyZWRFeHBlbnNlcztcblxuICAgIC8vIFJlY2FsY3VsYXIgZWwgcHJlc3VwdWVzdG8gZGlzcG9uaWJsZSB5IGdhc3RhZG9cbiAgICB0aGlzLmNhbGN1bGF0ZVNwZW50KCk7XG4gIH1cbn1cblxuY2xhc3MgVXNlckludGVyZmFjZSB7XG4gIGluc2VydE5hbWUodXNlck5hbWUpIHtcbiAgICBjb25zdCBidWRnZXRVc2VyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgLmJ1ZGdldF9faGVhZGluZy0tdXNlci1uYW1lYFxuICAgICk7XG5cbiAgICAvLyBJbnNlcnRhciBlbCBub21icmUgZGVsIHVzdWFyaW8gZW4gZWwgSFRNTFxuICAgIGJ1ZGdldFVzZXJOYW1lLnRleHRDb250ZW50ID0gYCR7dXNlck5hbWV9IWA7XG4gIH1cblxuICBpbnNlcnRCdWRnZXQocXVhbnRpdHkpIHtcbiAgICBjb25zdCB7IGJ1ZGdldFRvdGFsLCBidWRnZXRBdmFpbGFibGUsIGJ1ZGdldFNwZW50IH0gPSBxdWFudGl0eTtcblxuICAgIC8vIEZvcm1hdGVhciBlbCB0b3RhbCB5IGRpc3BvbmlibGUgZW4gbW9uZWRhIGxvY2FsIE1YTlxuICAgIGxldCBmb3JtYXR0ZWRUb3RhbCA9IGJ1ZGdldFRvdGFsLnRvTG9jYWxlU3RyaW5nKFwiZXMtTVhcIiwge1xuICAgICAgc3R5bGU6IFwiY3VycmVuY3lcIixcbiAgICAgIGN1cnJlbmN5OiBcIk1YTlwiLFxuICAgIH0pO1xuICAgIGxldCBmb3JtYXR0ZWRBdmFpbGFibGUgPSBidWRnZXRBdmFpbGFibGUudG9Mb2NhbGVTdHJpbmcoXCJlcy1NWFwiLCB7XG4gICAgICBzdHlsZTogXCJjdXJyZW5jeVwiLFxuICAgICAgY3VycmVuY3k6IFwiTVhOXCIsXG4gICAgfSk7XG4gICAgbGV0IGZvcm1hdHRlZFNwZW50ID0gYnVkZ2V0U3BlbnQudG9Mb2NhbGVTdHJpbmcoXCJlcy1NWFwiLCB7XG4gICAgICBzdHlsZTogXCJjdXJyZW5jeVwiLFxuICAgICAgY3VycmVuY3k6IFwiTVhOXCIsXG4gICAgfSk7XG5cbiAgICAvLyBJbnNlcnRhciBlbCB0b3RhbCB5IGRpc3BvbmlibGUgZW4gZWwgSFRNTFxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgI2J1ZGdldENhcmRUb3RhbGBcbiAgICApLnRleHRDb250ZW50ID0gYCR7Zm9ybWF0dGVkVG90YWx9YDtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCNidWRnZXRDYXJkQXZhaWxhYmxlYFxuICAgICkudGV4dENvbnRlbnQgPSBgJHtmb3JtYXR0ZWRBdmFpbGFibGV9YDtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCNidWRnZXRDYXJkU3BlbnRgXG4gICAgKS50ZXh0Q29udGVudCA9IGAke2Zvcm1hdHRlZFNwZW50fWA7XG4gIH1cblxuICBwcmludEFsZXJ0cyhtZXNzYWdlLCB0eXBlQWxlcnQpIHtcbiAgICAvLyBMaW1waWFyIGxhcyBhbGVydGFzIGFudGVyaW9yZXMgcGFyYSBldml0YXIgZHVwbGljYWRvcy5cbiAgICBsZXQgZXhpc3RpbmdBbGVydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5hbGVydC0tJHt0eXBlQWxlcnR9YCk7XG5cbiAgICAvLyBTaSBoYXkgdW5hIGFsZXJ0YSBkZWwgbWlzbW8gdGlwbywgYWN0dWFsaXphciBlbCBtZW5zYWplIHkgbm8gYWdyZWdhciB1bm8gbnVldm9cbiAgICBpZiAoZXhpc3RpbmdBbGVydCkge1xuICAgICAgZXhpc3RpbmdBbGVydC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDcmVhciBlbCBkaXYgZGUgbGEgYWxlcnRhXG4gICAgY29uc3QgYWxlcnRNZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChgcGApO1xuICAgIGFsZXJ0TWVzc2FnZS5jbGFzc0xpc3QuYWRkKGBhbGVydGApO1xuXG4gICAgLy8gQWdyZWdhciBlbCBtZW5zYWplIHkgZWwgdGlwbyBkZSBhbGVydGEgYWwgcCBkZSBsYSBhbGVydGFcbiAgICBpZiAodHlwZUFsZXJ0ID09PSBgZXJyb3JgKSB7XG4gICAgICBhbGVydE1lc3NhZ2UuY2xhc3NMaXN0LmFkZChgYWxlcnQtLWVycm9yYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFsZXJ0TWVzc2FnZS5jbGFzc0xpc3QuYWRkKGBhbGVydC0tc3VjY2Vzc2ApO1xuICAgIH1cblxuICAgIC8vIEFncmVnYXIgYWwgZGl2IGVsIG1lbnNhamVcbiAgICBhbGVydE1lc3NhZ2UudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuXG4gICAgLy8gSW5zZXJ0YXIgbGEgYWxlcnRhIGFsIEhUTUxcbiAgICBjb25zdCBidWRnZXRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2J1ZGdldEZvcm1gKTtcbiAgICBidWRnZXRGb3JtLmFwcGVuZENoaWxkKGFsZXJ0TWVzc2FnZSk7XG5cbiAgICAvLyBFbGltaW5hciBsYSBhbGVydGEgZGVzcHXDqXMgZGUgMyBzZWd1bmRvc1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgYWxlcnRNZXNzYWdlLnJlbW92ZSgpO1xuICAgIH0sIDIwMDApO1xuICB9XG5cbiAgc2hvd0V4cGVuc2VMaXN0KGV4cGVuc2VzKSB7XG4gICAgLy8gTGltcGlhciBsYSBsaXN0YSBkZSBnYXN0b3NcbiAgICB0aGlzLmNsZWFuSHRtbCgpO1xuXG4gICAgLy8gSXRlcmFyIGxvcyBnYXN0b3NcbiAgICBleHBlbnNlcy5mb3JFYWNoKChleHBlbnNlKSA9PiB7XG4gICAgICBjb25zdCB7IGlucHV0TmFtZSwgaW5wdXRBbW91bnQsIHNlbGVjdGVkQ2F0ZWdvcnksIGlkIH0gPSBleHBlbnNlO1xuXG4gICAgICAvLyBGb3JtYXRlYXIgbGEgY2FudGlkYWRcbiAgICAgIGNvbnN0IGZvcm1hdHRlZEFtb3VudCA9IGlucHV0QW1vdW50LnRvTG9jYWxlU3RyaW5nKFwiZXMtTVhcIiwge1xuICAgICAgICBzdHlsZTogXCJjdXJyZW5jeVwiLFxuICAgICAgICBjdXJyZW5jeTogXCJNWE5cIixcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhciBlbCBMaVxuICAgICAgY29uc3QgZXhwZW5zZUl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGBsaWApO1xuICAgICAgZXhwZW5zZUl0ZW0uY2xhc3NOYW1lID0gYGV4cGVuc2UtaXRlbWA7XG4gICAgICBleHBlbnNlSXRlbS5kYXRhc2V0LmlkID0gaWQ7XG4gICAgICBleHBlbnNlSXRlbS5kYXRhc2V0LmNhdGVnb3J5ID0gc2VsZWN0ZWRDYXRlZ29yeTtcblxuICAgICAgLy8gQWdyZWdhciBlbCBIVE1MXG4gICAgICBleHBlbnNlSXRlbS5pbm5lckhUTUwgPSBgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJleHBlbnNlLWl0ZW1fX3RleHRzXCI+XG4gICAgICAgICAgPHAgY2xhc3M9XCJleHBlbnNlLWl0ZW1fX2Rlc2NyaXB0aW9uXCI+JHtpbnB1dE5hbWV9PC9wPlxuICAgICAgICAgIDxwIGNsYXNzPVwiZXhwZW5zZS1pdGVtX19wcmljZVwiPiR7Zm9ybWF0dGVkQW1vdW50fTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICBgO1xuXG4gICAgICAvLyBCb3TDs24gcGFyYSBib3JyYXIgZWwgZ2FzdG9cbiAgICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYGJ1dHRvbmApO1xuICAgICAgZGVsZXRlQnRuLmNsYXNzTGlzdC5hZGQoYGV4cGVuc2UtaXRlbV9fYnRuYCk7XG4gICAgICBkZWxldGVCdG4udGV4dENvbnRlbnQgPSBgWGA7XG4gICAgICBkZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihgY2xpY2tgLCAoKSA9PiB7XG4gICAgICAgIGRlbGV0ZUV4cGVuc2UoaWQpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEHDsWFkaXIgZWwgYm90w7NuIGFsIExpXG4gICAgICBleHBlbnNlSXRlbS5hcHBlbmRDaGlsZChkZWxldGVCdG4pO1xuXG4gICAgICAvLyBBw7FhZGlyIGVsIExpIGFsIFVsXG4gICAgICBleHBlbnNlc0xpc3QuYXBwZW5kQ2hpbGQoZXhwZW5zZUl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgY2xlYW5IdG1sKCkge1xuICAgIHdoaWxlIChleHBlbnNlc0xpc3QuZmlyc3RDaGlsZCkge1xuICAgICAgZXhwZW5zZXNMaXN0LnJlbW92ZUNoaWxkKGV4cGVuc2VzTGlzdC5maXJzdENoaWxkKTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVBdmFpbGFibGVCdWRnZXQoYXZhaWxhYmxlLCBzcGVudCkge1xuICAgIGxldCBmb3JtYXR0ZWRBdmFpbGFibGUgPSBhdmFpbGFibGUudG9Mb2NhbGVTdHJpbmcoXCJlcy1NWFwiLCB7XG4gICAgICBzdHlsZTogXCJjdXJyZW5jeVwiLFxuICAgICAgY3VycmVuY3k6IFwiTVhOXCIsXG4gICAgfSk7XG4gICAgbGV0IGZvcm1hdHRlZFNwZW50ID0gc3BlbnQudG9Mb2NhbGVTdHJpbmcoXCJlcy1NWFwiLCB7XG4gICAgICBzdHlsZTogXCJjdXJyZW5jeVwiLFxuICAgICAgY3VycmVuY3k6IFwiTVhOXCIsXG4gICAgfSk7XG5cbiAgICAvLyBBY3R1YWxpemFyIGVsIGRpc3BvbmlibGUgeSBlbCBnYXN0YWRvIGVuIGVsIEhUTUxcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCNidWRnZXRDYXJkQXZhaWxhYmxlYFxuICAgICkudGV4dENvbnRlbnQgPSBgJHtmb3JtYXR0ZWRBdmFpbGFibGV9YDtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCNidWRnZXRDYXJkU3BlbnRgXG4gICAgKS50ZXh0Q29udGVudCA9IGAke2Zvcm1hdHRlZFNwZW50fWA7XG4gIH1cblxuICBjaGVja0J1ZGdldChidWRnZXRPYmopIHtcbiAgICBjb25zdCB7IGJ1ZGdldFRvdGFsLCBidWRnZXRBdmFpbGFibGUgfSA9IGJ1ZGdldE9iajtcblxuICAgIC8qICAgaWYgKGJ1ZGdldFRvdGFsIC8gNCA+IGJ1ZGdldEF2YWlsYWJsZSkge1xuICAgICAgY29uc29sZS5sb2coYEdhc3Rhc3RlIGVsIDc1JWApO1xuICAgIH0gZWxzZSBpZiAoYnVkZ2V0VG90YWwgLyAyID4gYnVkZ2V0QXZhaWxhYmxlKSB7XG4gICAgICBjb25zb2xlLmxvZyhgR2FzdGFzdGUgZWwgNTAlYCk7XG4gICAgfSAqL1xuXG4gICAgY29uc3QgYnVkZ2V0Rm9ybUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5idWRnZXQtZm9ybV9fYnRuYCk7XG5cbiAgICAvLyBEZXNhY3RpdmFyIGVsIGJvdMOzbiBkZSBhZ3JlZ2FyIGdhc3RvIHNpIGVsIHByZXN1cHVlc3RvIGVzdMOhIGFnb3RhZG9cbiAgICBpZiAoYnVkZ2V0QXZhaWxhYmxlIDw9IDApIHtcbiAgICAgIHVzZXJJbnRlcmZhY2UucHJpbnRBbGVydHMoYEVsIHByZXN1cHVlc3RvIHNlIGhhIGFnb3RhZG9gLCBgZXJyb3JgKTtcbiAgICAgIGJ1ZGdldEZvcm1CdG4uZGlzYWJsZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBidWRnZXRGb3JtQnRuLmRpc2FibGVkID0gZmFsc2U7XG4gICAgfVxuICB9XG59XG5cbi8qIEluc3RhbmNpYXMgKi9cbmxldCBidWRnZXQ7XG5jb25zdCB1c2VySW50ZXJmYWNlID0gbmV3IFVzZXJJbnRlcmZhY2UoKTtcblxuLyogRnVuY2lvbmVzICovXG5cbmZ1bmN0aW9uIGxvYWRMb2NhbFN0b3JhZ2UoKSB7XG4gIGxldCB1c2VyTmFtZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oYHVzZXJuYW1lYCkpO1xuICBsZXQgYnVkZ2V0RGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oYGJ1ZGdldGApKTtcblxuICAvLyBTaSBleGlzdGUgZWwgbm9tYnJlIGRlIHVzdWFyaW8sIGltcHJpbWUgbG9zIGRhdG9zIGVuIGxhIFVJXG4gIGlmICh1c2VyTmFtZSkge1xuICAgIHVzZXJJbnRlcmZhY2UuaW5zZXJ0TmFtZSh1c2VyTmFtZSk7XG4gIH0gZWxzZSB7XG4gICAgLy8gUGVkaXIgZWwgbm9tYnJlIGRlbCB1c3VhcmlvXG4gICAgcmVxdWVzdE5hbWUodXNlck5hbWUpO1xuICB9XG5cbiAgLy8gU2kgZXhpc3RlbiBkYXRvcyBlbiBlbCBMb2NhbFN0b3JhZ2U6XG4gIGlmIChidWRnZXREYXRhKSB7XG4gICAgLy8gUmVjdXBlcmFyIGxvcyBkYXRvcyBkZWwgcHJlc3VwdWVzdG8gZGVzZGUgZWwgbG9jYWxTdG9yYWdlXG4gICAgY29uc3QgeyBidWRnZXRUb3RhbCwgYnVkZ2V0QXZhaWxhYmxlLCBidWRnZXRTcGVudCwgZXhwZW5zZXMgfSA9IGJ1ZGdldERhdGE7XG5cbiAgICAvLyBJbnN0YW5jaWFyIGVsIG9iamV0byBkZSBwcmVzdXB1ZXN0b1xuICAgIGJ1ZGdldCA9IG5ldyBCdWRnZXQoYnVkZ2V0VG90YWwpO1xuICAgIGJ1ZGdldC5idWRnZXRBdmFpbGFibGUgPSBidWRnZXRBdmFpbGFibGU7XG4gICAgYnVkZ2V0LmJ1ZGdldFNwZW50ID0gYnVkZ2V0U3BlbnQ7XG4gICAgYnVkZ2V0LmV4cGVuc2VzID0gZXhwZW5zZXM7XG5cbiAgICAvLyBMbGFtYXIgYWwgbcOpdG9kbyBwYXJhIGluc2VydGFyIGVsIHByZXN1cHVlc3RvIGVuIGxhIFVJXG4gICAgdXNlckludGVyZmFjZS5pbnNlcnRCdWRnZXQoYnVkZ2V0KTtcblxuICAgIGxvYWRFeHBlbnNlc1RvTG9jYWxTdG9yYWdlKCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gUGVkaXIgZWwgcHJlc3VwdWVzdG8gYWwgdXN1YXJpb1xuICAgIHJlcXVlc3RCdWRnZXQoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsb2FkRXhwZW5zZXNUb0xvY2FsU3RvcmFnZSgpIHtcbiAgY29uc3QgeyBidWRnZXRBdmFpbGFibGUsIGJ1ZGdldFNwZW50LCBleHBlbnNlcyB9ID0gYnVkZ2V0O1xuXG4gIC8vIExsYW1hciBhbCBtw6l0b2RvIHBhcmEgaW5zZXJ0YXIgbG9zIGdhc3RvcyBlbiBsYSBVSVxuICB1c2VySW50ZXJmYWNlLnNob3dFeHBlbnNlTGlzdChleHBlbnNlcyk7XG5cbiAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBhY3R1YWxpemFyIGVsIHByZXN1cHVlc3RvIGRpc3BvbmlibGUgeSBnYXN0YWRvIGVuIGxhIFVJXG4gIHVzZXJJbnRlcmZhY2UudXBkYXRlQXZhaWxhYmxlQnVkZ2V0KGJ1ZGdldEF2YWlsYWJsZSwgYnVkZ2V0U3BlbnQpO1xuXG4gIC8vIExsYW1hciBhbCBtw6l0b2RvIHBhcmEgdmVyaWZpY2FyIGVsIHByZXN1cHVlc3RvIGVuIGxhIFVJXG4gIHVzZXJJbnRlcmZhY2UuY2hlY2tCdWRnZXQoYnVkZ2V0KTtcbn1cblxuZnVuY3Rpb24gcmVxdWVzdE5hbWUodXNlck5hbWUpIHtcbiAgLy8gU29saWNpdGFyIGVsIG5vbWJyZSBkZWwgdXN1YXJpbyBoYXN0YSBxdWUgc2UgaW5ncmVzZSB1biB2YWxvciB2w6FsaWRvXG4gIGRvIHtcbiAgICB1c2VyTmFtZSA9IHByb21wdChgwr9DdcOhbCBlcyB0dSBub21icmU/YCk7XG5cbiAgICAvLyBWYWxpZGFyIGVsIG5vbWJyZVxuICAgIGlmICghdXNlck5hbWUpIHtcbiAgICAgIGFsZXJ0KGBQb3IgZmF2b3IsIGludHJvZHVjZSB1biBub21icmUgdsOhbGlkby5gKTtcbiAgICB9XG4gIH0gd2hpbGUgKCF1c2VyTmFtZSk7XG5cbiAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBpbnNlcnRhciBlbCBub21icmUgZW4gbGEgVUlcbiAgdXNlckludGVyZmFjZS5pbnNlcnROYW1lKHVzZXJOYW1lKTtcblxuICAvLyBHdWFyZGFyIGVsIG5vbWJyZSBlbiBlbCBMb2NhbFN0b3JhZ2VcbiAgc2F2ZVRvTG9jYWxTdG9yYWdlKGB1c2VybmFtZWAsIHVzZXJOYW1lKTtcbn1cblxuZnVuY3Rpb24gcmVxdWVzdEJ1ZGdldCgpIHtcbiAgY29uc3QgdXNlckJ1ZGdldCA9IE51bWJlcihwcm9tcHQoYMK/Q3XDoWwgZXMgdHUgcHJlc3VwdWVzdG8/YCkpO1xuICBjb25zdCB2b2lkVmFsdWUgPSBgYDtcblxuICBpZiAoXG4gICAgdXNlckJ1ZGdldCA9PT0gdm9pZFZhbHVlIHx8XG4gICAgdXNlckJ1ZGdldCA9PT0gbnVsbCB8fFxuICAgIGlzTmFOKHVzZXJCdWRnZXQpIHx8XG4gICAgdXNlckJ1ZGdldCA8PSAwXG4gICkge1xuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgfVxuXG4gIC8vIENyZWFyIGluc3RhbmNpYSBkZSBcIkJ1ZGdldFwiIHkgZXN0YWJsZWNlcmxvXG4gIGJ1ZGdldCA9IG5ldyBCdWRnZXQodXNlckJ1ZGdldCk7XG5cbiAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBpbnNlcnRhciBlbCBwcmVzdXB1ZXN0byBlbiBsYSBVSVxuICB1c2VySW50ZXJmYWNlLmluc2VydEJ1ZGdldChidWRnZXQpO1xuXG4gIC8vIEd1YXJkYXIgZWwgb2JqZXRvIGRlIHByZXN1cHVlc3RvIGVuIGVsIGxvY2FsU3RvcmFnZVxuICBzYXZlVG9Mb2NhbFN0b3JhZ2UoYGJ1ZGdldGAsIGJ1ZGdldCk7XG59XG5cbmZ1bmN0aW9uIGJ1ZGdldEZvcm1FdmVudHMoKSB7XG4gIC8vIE9idGVuZXIgZWwgZm9ybXVsYXJpbyB5IHN1cyBldmVudG9zXG4gIGNvbnN0IGJ1ZGdldEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjYnVkZ2V0Rm9ybWApO1xuXG4gIGJ1ZGdldEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihgc3VibWl0YCwgYWRkRXhwZW5zZSk7XG59XG5cbmZ1bmN0aW9uIGFkZEV4cGVuc2UoZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgLy8gT2J0ZW5lciBsb3MgdmFsb3JlcyBkZWwgZm9ybXVsYXJpb1xuICBjb25zdCBpbnB1dE5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjYnVkZ2V0Rm9ybU5hbWVgKS52YWx1ZTtcbiAgY29uc3QgaW5wdXRBbW91bnQgPSBOdW1iZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2J1ZGdldEZvcm1BbW91bnRgKS52YWx1ZSk7XG4gIGNvbnN0IHNlbGVjdGVkQ2F0ZWdvcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjYnVkZ2V0Rm9ybUNhdGVnb3J5YCkudmFsdWU7XG4gIGxldCB2b2lkVmFsdWUgPSBgYDtcblxuICAvLyBWYWxpZGFyIHF1ZSBuaW5ndW5vIGRlIGxvcyBjYW1wb3MgZXN0w6kgdmFjw61vXG4gIGlmIChcbiAgICBpbnB1dE5hbWUgPT09IHZvaWRWYWx1ZSB8fFxuICAgIGlucHV0QW1vdW50ID09PSB2b2lkVmFsdWUgfHxcbiAgICBzZWxlY3RlZENhdGVnb3J5ID09PSB2b2lkVmFsdWVcbiAgKSB7XG4gICAgdXNlckludGVyZmFjZS5wcmludEFsZXJ0cyhgVG9kb3MgbG9zIGNhbXBvcyBzb24gb2JsaWdhdG9yaW9zYCwgYGVycm9yYCk7XG5cbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaW5wdXRBbW91bnQgPD0gMCB8fCBpc05hTihpbnB1dEFtb3VudCkpIHtcbiAgICB1c2VySW50ZXJmYWNlLnByaW50QWxlcnRzKGBDYW50aWRhZCBubyB2YWxpZGFgLCBgZXJyb3JgKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIENyZWFyIG9iamV0byBjb24gZWwgZ2FzdG9cbiAgY29uc3QgZXhwZW5zZSA9IHsgaW5wdXROYW1lLCBpbnB1dEFtb3VudCwgc2VsZWN0ZWRDYXRlZ29yeSwgaWQ6IERhdGUubm93KCkgfTtcblxuICAvLyBBw7FhZGlyIGVsIGdhc3RvIGEgbGEgbGlzdGEgeSBhbCBwcmVzdXB1ZXN0b1xuICBidWRnZXQubmV3RXhwZW5zZXMoZXhwZW5zZSk7XG5cbiAgLy8gT2J0ZW5lciBsb3MgdmFsb3JlcyBhY3R1YWxlcyBkZWwgcHJlc3VwdWVzdG8geSBnYXN0b1xuICBjb25zdCB7IGV4cGVuc2VzLCBidWRnZXRBdmFpbGFibGUsIGJ1ZGdldFNwZW50IH0gPSBidWRnZXQ7XG5cbiAgLy8gSW1wcmltaXIgZWwgZ2FzdG8gZW4gZWwgSFRNTFxuICB1c2VySW50ZXJmYWNlLnNob3dFeHBlbnNlTGlzdChleHBlbnNlcyk7XG5cbiAgLy8gQWN0dWFsaXphciBlbCBwcmVzdXB1ZXN0byBlbiBsYSBVSVxuICB1c2VySW50ZXJmYWNlLnVwZGF0ZUF2YWlsYWJsZUJ1ZGdldChidWRnZXRBdmFpbGFibGUsIGJ1ZGdldFNwZW50KTtcblxuICAvLyBMbGFtYXIgYWwgbcOpdG9kbyBwYXJhIGNvbXByb2JhciBzaSBzZSBoYSBhbGNhbnphZG8gZWwgcHJlc3VwdWVzdG9cbiAgdXNlckludGVyZmFjZS5jaGVja0J1ZGdldChidWRnZXQpO1xuXG4gIC8vIExpbXBpYXIgbG9zIGNhbXBvcyBkZWwgZm9ybXVsYXJpb1xuICBjb25zdCBidWRnZXRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgI2J1ZGdldEZvcm1gKTtcbiAgYnVkZ2V0Rm9ybS5yZXNldCgpO1xuXG4gIC8vIEd1YXJkYSBlbCBvYmpldG8gYnVkZ2V0IGFjdHVhbGl6YWRvIGVuIGVsIGxvY2FsU3RvcmFnZVxuICBzYXZlVG9Mb2NhbFN0b3JhZ2UoYGJ1ZGdldGAsIGJ1ZGdldCk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZUV4cGVuc2UoaWQpIHtcbiAgLy8gRWxpbWluYXIgZWwgZ2FzdG8gZGVsIG9iamV0b1xuICBidWRnZXQuZGVsZXRlRXhwZW5zZShpZCk7XG5cbiAgLy8gT2J0ZW5lciBsb3MgdmFsb3JlcyBhY3R1YWxlcyBkZWwgcHJlc3VwdWVzdG8geSBnYXN0b1xuICBjb25zdCB7IGV4cGVuc2VzLCBidWRnZXRBdmFpbGFibGUsIGJ1ZGdldFNwZW50IH0gPSBidWRnZXQ7XG5cbiAgLy8gRWxpbWluYXIgZWwgZ2FzdG8gZGVsIEhUTUxcbiAgdXNlckludGVyZmFjZS5zaG93RXhwZW5zZUxpc3QoZXhwZW5zZXMpO1xuXG4gIC8vIEFjdHVhbGl6YXIgZWwgcHJlc3VwdWVzdG8gZW4gbGEgVUlcbiAgdXNlckludGVyZmFjZS51cGRhdGVBdmFpbGFibGVCdWRnZXQoYnVkZ2V0QXZhaWxhYmxlLCBidWRnZXRTcGVudCk7XG5cbiAgLy8gTGxhbWFyIGFsIG3DqXRvZG8gcGFyYSBjb21wcm9iYXIgc2kgc2UgaGEgYWxjYW56YWRvIGVsIHByZXN1cHVlc3RvXG4gIHVzZXJJbnRlcmZhY2UuY2hlY2tCdWRnZXQoYnVkZ2V0KTtcblxuICAvLyBHdWFyZGEgZWwgb2JqZXRvIGJ1ZGdldCBhY3R1YWxpemFkbyBlbiBlbCBsb2NhbFN0b3JhZ2VcbiAgc2F2ZVRvTG9jYWxTdG9yYWdlKGBidWRnZXRgLCBidWRnZXQpO1xufVxuXG5mdW5jdGlvbiBzYXZlVG9Mb2NhbFN0b3JhZ2Uoa2V5LCB2YWx1ZSkge1xuICAvLyBHdWFyZGFyIGRhdG9zIGVuIGVsIExvY2FsU3RvcmFnZVxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG59XG4iXX0=
